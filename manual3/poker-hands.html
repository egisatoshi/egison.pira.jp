<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Programming Language Egison Users Manual</title>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8" />
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-9772679-2']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</head>

<body>
<h1>Example 1. Poker Hands</h1>
<hr/>
<p>
  In this section, we will describe the program that determine the poker hands.<br/>
  We do pattern matching collections of cards as a multiset of cards.<br/>
  The program codes that we describe in this section can are in <code>lib/poker-hands.egi</code> and <code>sample/poker-hands-test.egi</code>.<br/>
</p>

<p>
  First, we define the <code>card</code> type.<br/>
  To define it, we define the <code>suit</code> type, and the <code>mod</code>.<br/>
</p>

<p>
  The definition of the <code>suit</code> is as below.<br/>
</p>

<pre>
  <code>
(define $suit
  (matcher
    {[,$suit []
      {[$tgt (if (eq? tgt suit)
                 {[]}
                 {})]}]
     [&lt;spade&gt; []
      {[&lt;spade&gt; {[]}]
       [_ {}]}]
     [&lt;heart&gt; []
      {[&lt;heart&gt; {[]}]
       [_ {}]}]
     [&lt;club&gt; []
      {[&lt;club&gt; {[]}]
       [_ {}]}]
     [&lt;diamond&gt; []
      {[&lt;diamond&gt; {[]}]
       [_ {}]}]
     [$ [something]
      {[$tgt {tgt}]}]
     }))
  </code>
</pre>
  The definition of the <code>mod</code> is as below.<br/>
<p>

</p>
<pre>
  <code>
(define $mod
  (lambda [$m]
    (matcher
      {[,$n []
        {[$tgt (if (eq? (modulo tgt m) (modulo n m))
                   {[]}
                   {})]}]
       [$ [something]
        {[$tgt {(modulo tgt m)}]}]
       })))
  </code>
</pre>

<p>
  The <code>card</code> type is defined using those two types defined above.<br/>
</p>

<pre>
  <code>
(define $card
  (matcher
    {[,$val []
      {[$tgt (match [val tgt] [card card]
               {[[&lt;card $s $n&gt; &lt;card ,s ,n&gt;] {[]}]
                [[_ _] {}]})]}]
     [&lt;card $ $&gt; [suit (mod 13)]
      {[&lt;card $s $n&gt; {[s n]}]}]
     [$ [something]
      {[$tgt {tgt}]}]
     }))
  </code>
</pre>

<p>
  If we defined the <code>card</code> type as abobe, we can define a function that determine poker hands as following.<br/>
</p>

<pre>
  <code>
(define $poker-hands
  (lambda [$Cs]
    (match Cs (Multiset card)
      {[&lt;cons &lt;card $S $n&gt;
         &lt;cons &lt;card ,S ,(- n 1)&gt;
          &lt;cons &lt;card ,S ,(- n 2)&gt;
           &lt;cons &lt;card ,S ,(- n 3)&gt;
            &lt;cons &lt;card ,S ,(- n 4)&gt;
             !&lt;nil&gt;&gt;&gt;&gt;&gt;&gt;
        &lt;straight-flush&gt;]
       [&lt;cons &lt;card _ $n&gt;
         &lt;cons &lt;card _ ,n&gt;
          !&lt;cons &lt;card _ ,n&gt;
            !&lt;cons &lt;card _ ,n&gt;
              !&lt;cons _
                !&lt;nil&gt;&gt;&gt;&gt;&gt;&gt;
        &lt;four-of-kind&gt;]
       [&lt;cons &lt;card _ $m&gt;
         &lt;cons &lt;card _ ,m&gt;
          &lt;cons &lt;card _ ,m&gt;
           &lt;cons &lt;card _ $n&gt;
            !&lt;cons &lt;card _ ,n&gt;
              !&lt;nil&gt;&gt;&gt;&gt;&gt;&gt;
        &lt;full-house&gt;]
       [&lt;cons &lt;card $S _&gt;
         !&lt;cons &lt;card ,S _&gt;
           !&lt;cons &lt;card ,S _&gt;
             !&lt;cons &lt;card ,S _&gt;
               !&lt;cons &lt;card ,S _&gt;
                 !&lt;nil&gt;&gt;&gt;&gt;&gt;&gt;
        &lt;flush&gt;]
       [&lt;cons &lt;card _ $n&gt;
         &lt;cons &lt;card _ ,(- n 1)&gt;
          &lt;cons &lt;card _ ,(- n 2)&gt;
           &lt;cons &lt;card _ ,(- n 3)&gt;
            &lt;cons &lt;card _ ,(- n 4)&gt;
             !&lt;nil&gt;&gt;&gt;&gt;&gt;&gt;
        &lt;straight&gt;]
       [&lt;cons &lt;card _ $n&gt;
         &lt;cons &lt;card _ ,n&gt;
          &lt;cons &lt;card _ ,n&gt;
           &lt;cons _
            &lt;cons _
             !&lt;nil&gt;&gt;&gt;&gt;&gt;&gt;
        &lt;three-of-kind&gt;]
       [&lt;cons &lt;card _ $m&gt;
         &lt;cons &lt;card _ ,m&gt;
          !&lt;cons &lt;card _ $n&gt;
            &lt;cons &lt;card _ ,n&gt;
             !&lt;cons _
               !&lt;nil&gt;&gt;&gt;&gt;&gt;&gt;
        &lt;two-pair&gt;]
       [&lt;cons &lt;card _ $n&gt;
         &lt;cons &lt;card _ ,n&gt;
          &lt;cons _
           &lt;cons _
            &lt;cons _
             !&lt;nil&gt;&gt;&gt;&gt;&gt;&gt;
        &lt;one-pair&gt;]
       [&lt;cons _
         &lt;cons _
          &lt;cons _
           &lt;cons _
            &lt;cons _
             !&lt;nil&gt;&gt;&gt;&gt;&gt;&gt;
        &lt;nothing&gt;]})))
  </code>
</pre>

<p>
  We can use <code>poker-hands</code> function as follow.<br/>
</p>

<pre>
  <code>
&gt; (test (poker-hands {&lt;card &lt;club&gt; 4&gt;
                      &lt;card &lt;club&gt; 2&gt;
                      &lt;card &lt;club&gt; 13&gt;
                      &lt;card &lt;club&gt; 1&gt;
                      &lt;card &lt;club&gt; 3&gt;}))
&lt;straight-flush&gt;

&gt; (test (poker-hands {&lt;card &lt;diamond&gt; 1&gt;
                      &lt;card &lt;club&gt; 2&gt;
                      &lt;card &lt;club&gt; 1&gt;
                      &lt;card &lt;heart&gt; 1&gt;
                      &lt;card &lt;diamond&gt; 2&gt;}))
&lt;full-house&gt;

&gt; (test (poker-hands {&lt;card &lt;diamond&gt; 4&gt;
                      &lt;card &lt;club&gt; 2&gt;
                      &lt;card &lt;club&gt; 5&gt;
                      &lt;card &lt;heart&gt; 1&gt;
                      &lt;card &lt;diamond&gt; 3&gt;}))
&lt;straight&gt;
  
&gt; (test (poker-hands {&lt;card &lt;diamond&gt; 4&gt;
                      &lt;card &lt;club&gt; 10&gt;
                      &lt;card &lt;club&gt; 5&gt;
                      &lt;card &lt;heart&gt; 1&gt;
                      &lt;card &lt;diamond&gt; 3&gt;}))
&lt;nothing&gt;

  </code>
</pre>

</body>

<footer>
  <hr size=1 noshade>
  <table width=100% border=0 cellspacing=0>
    <tr>
      <td align=right>
        <i>
          <a href="http://egi.pira.jp">Egi Satoshi</a>
        </i>
    </tr>
  </table>
</footer>

</html>

